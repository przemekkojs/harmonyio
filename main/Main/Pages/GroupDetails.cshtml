@page
@model Main.Pages.GroupDetailsModel

<head>
    <link rel="stylesheet" href="~/css/creator-style.css" />
</head>

<div class="h-100 w-100 d-flex flex-row overflow-auto">
    <div class="w-50 flex-grow-1 overflow-auto d-flex flex-column pe-3">
        <div class="fw-bold fs-4 mb-3">Nauczyciele</div>
        @foreach (var user in Model.Teachers)
        {
            <div class="quiz p-0 flex-shrink-0 d-flex flex-row overflow-hidden p-3">
                <div class="flex-grow-1 d-flex flex-column">
                    <div class="fw-bold fs-5 mb-3">@user.FullName</div>

                    <form method="post" class="ms-auto mt-auto">
                        <input type="hidden" asp-for="UserId" value="@user.Id" />
                        <input type="hidden" asp-for="GroupId" value="@Model.GroupId"/>
                        <input type="hidden" asp-for="ForTeachers" value="@true" />
                        <button type="submit" asp-page-handler="QuitGroup" class="btn btn-danger">Usuń z grupy</button>
                    </form>
                </div>
            </div>
        }
        <div class="no-style" data-bs-toggle="modal" data-bs-target="#teacherModal">
            <div class="quiz quiz-add d-flex justify-content-center align-items-center">
                <span class="plus me-1">+</span>
                <span>Dodaj nauczycieli</span>
            </div>
        </div>

        <div class="fw-bold fs-4 mb-3">Studenci</div>
        @foreach (var user in Model.Students)
        {
            <div class="quiz p-0 flex-shrink-0 d-flex flex-row overflow-hidden p-3">
                <div class="flex-grow-1 d-flex flex-column">
                    <div class="fw-bold fs-5 mb-3">@user.FullName</div>

                    <form method="post" class="ms-auto mt-auto">
                        <input type="hidden" asp-for="UserId" value="@user.Id" />                            
                        <input type="hidden" asp-for="ForTeachers" value="@false" />
                        <button type="submit" asp-page-handler="QuitGroup" class="btn btn-danger">Usuń z grupy</button>
                    </form>
                </div>
            </div>
            
        
        }    
        <div class="no-style" data-bs-toggle="modal" data-bs-target="#studentModal">
            <div class="quiz quiz-add d-flex justify-content-center align-items-center">
                <span class="plus me-1">+</span>
                <span>Dodaj uczniów</span>
            </div>
        </div>
    </div> 

    <div class="vr"></div>

    <div class="w-50 flex-grow-1 overflow-auto d-flex flex-column ps-3">
        <div class="fw-bold fs-4 mb-3">Nauczyciele</div>
        @foreach (var request in Model.Requests)
        {
            <div class="quiz p-0 flex-shrink-0 d-flex flex-row overflow-hidden p-3">
                <div class="flex-grow-1 d-flex flex-column">
                    <div class="fw-bold fs-5 mb-3">@request.User.Email</div>
                    <div class="d-flex flex-row align-items-center">
                        <i class="fas fa-music icon-sm me-2"></i>
                        <span class="fw-bold me-1">Wygasa:</span>
                        <span>@request.ExpirationDate</span>
                    </div>
                </div>

                <div class="d-flex flex-column h-100">
                    <form method="post" class="ms-auto mt-auto">
                        <input type="hidden" asp-for="Id" value="@request.Id" />
                        <button type="submit" asp-page-handler="RmRequest" class="btn btn-outline-primary">Usuń</button>
                    </form>
                </div>
            </div>
        }

        

    </div>
</div>



@foreach(var forTeachers in new[] {true, false})
{
    var x = forTeachers ? "Teacher" : "Student";

    <!-- Modal -->
    <div class="modal fade" id="@(forTeachers ? "teacherModal" : "studentModal")" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <form method="post" class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Dodaj @(forTeachers ? "nauczycieli" : "uczniów")</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
                <div class="d-flex flex-column">
                    <div class="flex-grow-1 d-flex overflow-auto">
                        <div class="flex-grow-1 d-flex flex-column overflow-auto">
                            <div class="mb-3">
                                <input type="hidden" asp-for="GroupId" value="@Model.GroupId" />                            
                                <input type="hidden" asp-for="ForTeachers" value="@forTeachers" />

                                <span asp-validation-for="Emails" id="emails@(x)-validation-error" class="text-danger mb-1"></span>

                                <div id="email@(x)-container" class="d-flex flex-column">
                                    @* MAIL INPUTS ADDED WITH JS *@
                                </div>
                                <div class="task task-add d-flex justify-content-center align-items-center" onclick="addEmail@(x)()">
                                    <span class="plus">+</span>
                                    <span>Dodaj email</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        <div class="modal-footer">
            <button type="submit" asp-page-handler="SendRequests" class="btn btn-primary btn-std-width ms-auto">Zaproś do grupy</button>
        </div>
        </form>
    </div>
    </div>

    
    <script>
        let emails@(x) = [];
        function addEmail@(x)() {
            emails@(x).push("");
            renderEmails@(x)();
            document.getElementById('emails@(x)-validation-error').innerText = '';
        }
        function updateEmail@(x)(index, value) {
            emails@(x)[index] = value;
            document.getElementById('emails@(x)-validation-error').innerText = '';
        }
        function removeEmail@(x)(index) {
            emails@(x).splice(index, 1);
            renderEmails@(x)();
        }
        function renderEmails@(x)() {
            const emailContainer = document.getElementById('email@(x)-container');
            emailContainer.innerHTML = '';
            emails@(x).forEach((email, index) => {
                emailContainer.innerHTML += `
                    <div class="task task-creator p-0 overflow-hidden">
                        <div class="d-flex h-100 align-items-center bg-secondary">
                            <div class="task-number text-white">${index + 1}</div>
                            <div class="vr"></div>
                        </div>
                        <div class="task-content w-100 p-3">
                            <input type="text" name="Emails@(x)[${index}]" class="form-control task-input" value="${email}" oninput="updateEmail@(x)(${index}, this.value)">
                        </div>
                        <div class="d-flex h-100 align-items-center">
                            <div class="vr"></div>
                            <button class="delete-btn" onclick="removeEmail@(x)(${index})">🗑️</button>
                        </div>
                    </div>`;
            });
        }
        renderEmails@(x)();
    </script>
}

@section Scripts {
    @{
        <partial name="_ValidationScriptsPartial" />
    }
}